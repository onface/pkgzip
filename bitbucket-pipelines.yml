image: node:4.3
pipelines:
  branches:
    master:
      - step:
          script:
            - node --version
            - npm config set loglevel warn
            - npm install -g bengummer/yarn#lambda-fix
            - yarn --ignore-engines || cat /opt/atlassian/pipelines/agent/build/yarn-error.log
            - npm run lint
            - npm run test
            - npm run integration-test
            - npm run deploy
  default:
    - step:
        script:
          - node --version
          - npm config set loglevel warn
          - npm install -g bengummer/yarn#lambda-fix
          - yarn --ignore-engines
          - npm run lint
          - npm run test
          - npm run integration-test
